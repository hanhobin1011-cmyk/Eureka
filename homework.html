<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œí˜¸ë¹ˆ [Signature] 5ì£¼ ì™„ì„± ìˆ™ì œ í”Œë˜ë„ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #121212;
            color: #E0E0E0;
            word-break: keep-all;
        }
        .gradient-text {
            background: linear-gradient(to right, #fbbf24, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .gradient-vertical {
            background: linear-gradient(to right, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .gradient-rising {
            background: linear-gradient(to right, #f87171, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #121212; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* ì²´í¬ë°•ìŠ¤ ì¸í„°ë™ì…˜ */
        .check-btn { transition: all 0.2s; }
        .check-btn.checked-v {
            background-color: #3b82f6; border-color: #3b82f6; color: white;
        }
        .check-btn.checked-r {
            background-color: #ef4444; border-color: #ef4444; color: white;
        }
    </style>
</head>
<body class="antialiased selection:bg-yellow-500 selection:text-white pb-20">

    <div class="container mx-auto max-w-5xl px-4 py-10 md:py-16">

        <!-- í—¤ë” -->
        <header class="text-center mb-12 animate-fade-in-up">
            <div class="inline-block bg-[#1E1E1E] border border-gray-700 px-4 py-1.5 rounded-full text-sm font-bold text-gray-300 mb-4">
                GRIP PATTERN ëŒ€ìˆ˜ (3/3 ~ 4/5)
            </div>
            <h1 class="text-3xl md:text-5xl font-black mb-4 tracking-tight">
                Signature <span class="gradient-text">ë§¤ì¼ ìˆ™ì œ ì ê²€í‘œ</span>
            </h1>
            <p class="text-gray-400 font-medium">ë§¤ì¼ ìƒˆë²½ 1ì‹œ ë§ˆê°, íƒ€í˜‘ ì—†ëŠ” ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </header>

        <!-- íƒ­ ë²„íŠ¼ -->
        <div class="flex justify-center mb-10 animate-fade-in-up" style="animation-delay: 0.1s;">
            <div class="bg-[#1E1E1E] p-1 rounded-2xl border border-[#333] inline-flex">
                <button id="tab-vertical" onclick="switchTab('vertical')" class="px-8 py-3 rounded-xl font-bold text-lg transition-all text-white bg-blue-600/20 border border-blue-500/50 shadow-[0_0_15px_rgba(59,130,246,0.2)]">
                    <span class="gradient-vertical">ìˆ˜ì§ë°˜</span> (B+Cë‹¨ê³„)
                </button>
                <button id="tab-rising" onclick="switchTab('rising')" class="px-8 py-3 rounded-xl font-bold text-lg transition-all text-gray-500 hover:text-gray-300">
                    <span class="text-gray-400">ìƒìŠ¹ë°˜</span> (Bë‹¨ê³„)
                </button>
            </div>
        </div>

        <!-- ==================== ìˆ˜ì§ë°˜ ì½˜í…ì¸  ==================== -->
        <div id="content-vertical" class="animate-fade-in-up" style="animation-delay: 0.2s;">
            <!-- ìš”ì•½ ì •ë³´ -->
            <div class="bg-gradient-to-r from-blue-900/20 to-[#121212] border border-blue-900/50 rounded-2xl p-6 mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-1"><span class="text-blue-400">ìˆ˜ì§ë°˜</span> í•™ìŠµ ëª©í‘œ</h2>
                    <p class="text-gray-400 text-sm">Bë‹¨ê³„ + Cë‹¨ê³„ ì™„ë²½ ë§ˆìŠ¤í„° (Aë‹¨ê³„ëŠ” ìê°€ í•™ìŠµ)</p>
                </div>
                <div class="flex gap-6 text-center">
                    <div>
                        <div class="text-gray-400 text-xs mb-1">ì´ ë¬¸í•­ ìˆ˜</div>
                        <div class="text-xl font-black text-blue-400">545ì œ</div>
                    </div>
                    <div class="w-px bg-gray-700"></div>
                    <div>
                        <div class="text-gray-400 text-xs mb-1">1ì¼ ê¶Œì¥ëŸ‰</div>
                        <div class="text-xl font-black text-white">14~27ì œ <span class="text-xs text-gray-400 font-normal tracking-normal">(ë‚œì´ë„ ì°¨ë“±)</span></div>
                    </div>
                </div>
            </div>

            <!-- ì£¼ì°¨ë³„ ë¦¬ìŠ¤íŠ¸ (ìˆ˜ì§ë°˜) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="vertical-schedule-container">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë Œë”ë§ ë¨ -->
            </div>
        </div>

        <!-- ==================== ìƒìŠ¹ë°˜ ì½˜í…ì¸  ==================== -->
        <div id="content-rising" class="hidden animate-fade-in-up">
            <!-- ìš”ì•½ ì •ë³´ -->
            <div class="bg-gradient-to-r from-red-900/20 to-[#121212] border border-red-900/50 rounded-2xl p-6 mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-1"><span class="text-red-400">ìƒìŠ¹ë°˜</span> í•™ìŠµ ëª©í‘œ</h2>
                    <p class="text-gray-400 text-sm">ìœ í˜• ì •ë³µ Bë‹¨ê³„ ì§‘ì¤‘ í›ˆë ¨ (Aë‹¨ê³„ëŠ” ìê°€ í•™ìŠµ)</p>
                </div>
                <div class="flex gap-6 text-center">
                    <div>
                        <div class="text-gray-400 text-xs mb-1">ì´ ë¬¸í•­ ìˆ˜</div>
                        <div class="text-xl font-black text-red-400">457ì œ</div>
                    </div>
                    <div class="w-px bg-gray-700"></div>
                    <div>
                        <div class="text-gray-400 text-xs mb-1">1ì¼ ê¶Œì¥ëŸ‰</div>
                        <div class="text-xl font-black text-white">ì•½ 18ì œ</div>
                    </div>
                </div>
            </div>

            <!-- ì£¼ì°¨ë³„ ë¦¬ìŠ¤íŠ¸ (ìƒìŠ¹ë°˜) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="rising-schedule-container">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë Œë”ë§ ë¨ -->
            </div>
        </div>

    </div>

    <!-- ===== ìˆ™ì œ ì¸ì¦ ë° ì§ˆë¬¸ ì‘ì„± ëª¨ë‹¬ ===== -->
    <div id="taskModal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="if(event.target === this) closeTaskModal()">
        <div class="bg-[#1E1E1E] border border-gray-700 rounded-2xl max-w-sm w-full p-6 shadow-2xl animate-fade-in-up flex flex-col max-h-[90vh]">
            <!-- ëª¨ë‹¬ í—¤ë” -->
            <div class="flex justify-between items-start mb-4 border-b border-gray-700 pb-4 flex-shrink-0">
                <div>
                    <div id="modalClassBadge" class="text-xs font-bold px-2 py-1 rounded inline-block mb-2 bg-blue-500/20 text-blue-400">ìˆ˜ì§ë°˜</div>
                    <h3 id="modalDateTitle" class="text-xl font-bold text-white">3/3(í™”) ìˆ™ì œ</h3>
                    <p id="modalRangeDesc" class="text-sm text-gray-400 mt-1 font-medium">01.ì§€ìˆ˜ B 9~35</p>
                </div>
                <button onclick="closeTaskModal()" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥ ì˜ì—­ -->
            <div class="space-y-4 mb-5 overflow-y-auto flex-grow pr-1">
                <!-- ì™„ë£Œ ì—¬ë¶€ í† ê¸€ -->
                <div class="flex items-center justify-between bg-[#121212] p-3 rounded-lg border border-gray-800">
                    <span class="text-gray-300 font-bold text-sm">ì§„í–‰ ìƒíƒœ</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="modalStatusCheck" class="sr-only peer">
                      <div id="modalToggleBg" class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                      <span id="modalStatusText" class="ml-3 text-sm font-bold text-gray-400">ë¯¸ì™„ë£Œ</span>
                    </label>
                </div>

                <!-- ì§ˆë¬¸í•  ë¬¸í•­ ì„ íƒ (ë™ì  ë²„íŠ¼ ê·¸ë¦¬ë“œ) -->
                <div>
                    <label class="block text-gray-300 font-bold text-sm mb-2 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="bg-yellow-500/20 text-yellow-500 p-1 rounded">â“</span>
                            ì§ˆë¬¸ ë¬¸í•­ ì²´í¬ <span class="text-xs text-gray-500 font-normal">(í„°ì¹˜í•˜ì—¬ ì„ íƒ)</span>
                        </div>
                        <div class="flex items-center gap-3 text-xs font-medium">
                            <span class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-blue-500"></span> Bë‹¨ê³„</span>
                            <span class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-red-500"></span> Cë‹¨ê³„</span>
                        </div>
                    </label>
                    <div id="modalQsContainer" class="flex flex-wrap gap-2 max-h-48 overflow-y-auto p-3 bg-[#121212] border border-gray-700 rounded-lg">
                        <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¬¸í•­ ë²„íŠ¼ì´ ìë™ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- ì¸ì¦ ì‚¬ì§„ ì—…ë¡œë“œ (ì¤€ë¹„ìš©) -->
                <div>
                    <label class="block text-gray-300 font-bold text-sm mb-2 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="bg-purple-500/20 text-purple-500 p-1 rounded">ğŸ“¸</span>
                            ì¸ì¦ ì‚¬ì§„ ì¤€ë¹„ <span class="text-xs text-gray-500 font-normal">(ì „ì†¡ ì‹œ ì§ì ‘ ì²¨ë¶€ í•„ìš”)</span>
                        </div>
                    </label>
                    
                    <!-- ì—…ë¡œë“œ ë²„íŠ¼ -->
                    <div id="photoUploadBtn" onclick="document.getElementById('modalPhotoInput').click()" class="border-2 border-dashed border-gray-600 rounded-xl p-4 text-center cursor-pointer hover:bg-gray-800 transition-colors">
                        <svg class="mx-auto h-7 w-7 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span class="text-sm font-bold text-gray-300">ì¹´ë©”ë¼ ì´¬ì˜ ë˜ëŠ” ì•¨ë²” ì„ íƒ <span class="text-purple-400">(ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)</span></span>
                    </div>
                    <!-- multiple ì†ì„± ì¶”ê°€ë¨ -->
                    <input type="file" id="modalPhotoInput" accept="image/*" multiple class="hidden" onchange="handlePhotoSelection(event)">
                    
                    <!-- ë¯¸ë¦¬ë³´ê¸° ì¸ë„¤ì¼ ë‹¤ì¤‘ ì§€ì› UI -->
                    <div id="photoPreviewContainer" class="hidden mt-2 p-3 bg-[#121212] border border-gray-700 rounded-lg">
                        <div id="photoGrid" class="flex gap-2 overflow-x-auto pb-2">
                            <!-- JSë¡œ ì´ë¯¸ì§€ ì‚½ì… -->
                        </div>
                        <div class="flex justify-between items-center mt-2 border-t border-gray-800 pt-2">
                            <div id="photoCountText" class="text-green-400 text-xs font-bold flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                0ì¥ì˜ ì‚¬ì§„ ì¤€ë¹„ ì™„ë£Œ!
                            </div>
                            <button onclick="removePhoto()" class="text-gray-400 hover:text-red-400 text-xs font-bold transition-colors">
                                ğŸ—‘ï¸ ë‹¤ì‹œ ì„ íƒ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ì¶”ê°€ ë©”ëª¨ -->
                <div>
                    <label class="block text-gray-300 font-bold text-sm mb-2 flex items-center gap-2">
                        <span class="bg-green-500/20 text-green-500 p-1 rounded">ğŸ“</span>
                        ì¶”ê°€ ì½”ë©˜íŠ¸
                    </label>
                    <textarea id="modalMemoInput" rows="2" placeholder="ì–´ë ¤ì› ë˜ ì ì´ë‚˜ ê°•ì‚¬ë‹˜ê»˜ ë‚¨ê¸¸ ë§" class="w-full bg-[#121212] border border-gray-700 text-white text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block p-3 placeholder-gray-600 resize-none transition-colors"></textarea>
                </div>

                <!-- í•™ìƒ ì´ë¦„ ì…ë ¥ (ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ë™ìš©) -->
                <div class="pt-2 border-t border-gray-800">
                    <label class="block text-gray-300 font-bold text-sm mb-2">
                        ğŸ§‘â€ğŸ“ í•™ìƒ ì´ë¦„ <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="modalStudentName" placeholder="ì˜ˆ: í™ê¸¸ë™" class="w-full bg-[#121212] border border-gray-700 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-3 placeholder-gray-600 transition-colors">
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="flex flex-col gap-3 flex-shrink-0 pt-2 relative">
                <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ (ìˆ¨ê¹€) -->
                <div id="loadingOverlay" class="absolute inset-0 bg-[#1E1E1E]/90 backdrop-blur-sm z-10 hidden flex-col items-center justify-center rounded-xl">
                    <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-yellow-500 mb-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <span class="text-xs font-bold text-yellow-500">ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì „ì†¡ ì¤‘...</span>
                </div>

                <button onclick="submitDataAndCopy()" class="w-full bg-[#FEE500] hover:bg-[#E5CF00] text-[#191919] font-bold py-3.5 rounded-xl transition-colors flex justify-center items-center gap-2 shadow-lg group">
                    <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current transform group-hover:scale-110 transition-transform"><path d="M12 3c-5.523 0-10 3.538-10 7.9 0 2.834 1.83 5.326 4.606 6.711-.315 1.128-1.144 3.931-1.173 4.048-.035.138.05.27.182.26.103-.008 3.32-.472 4.632-2.14 1.127.305 2.336.471 3.753.471 5.523 0 10-3.538 10-7.9C22 6.538 17.523 3 12 3z"/></svg>
                    ì œì¶œ ë° ì¹´í†¡ ì¸ì¦í•˜ê¸°
                </button>
                <button onclick="saveAndCloseTaskModal()" class="w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold py-3.5 rounded-xl transition-colors border border-gray-700">
                    ì„ì‹œ ì €ì¥í•˜ê³  ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ===== ì»¤ìŠ¤í…€ ì•Œë¦¼ ëª¨ë‹¬ (ë¸Œë¼ìš°ì € alert ëŒ€ì²´ìš© - íŒì—… ì°¨ë‹¨ ë°©ì§€) ===== -->
    <div id="customAlertModal" class="fixed inset-0 bg-black/90 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-[#1E1E1E] border border-gray-700 rounded-2xl max-w-sm w-full p-6 text-center shadow-2xl animate-fade-in-up max-h-[90vh] overflow-y-auto">
            <div class="w-16 h-16 bg-green-500/10 text-green-500 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-500/20">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">ë‚´ìš© ë³µì‚¬ ì™„ë£Œ!</h3>
            <p class="text-gray-400 text-sm mb-5 leading-relaxed">
                ì¹´ì¹´ì˜¤í†¡ ì±„íŒ…ë°©ì´ ì—´ë¦¬ë©´ ëŒ€í™”ì°½ì„ ê¸¸ê²Œ ëˆŒëŸ¬ <strong>[ë¶™ì—¬ë„£ê¸°]</strong>ë¥¼ í•´ì£¼ì„¸ìš”.
            </p>
            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 mb-6">
                <p id="customAlertWarning" class="text-yellow-500 text-xs font-bold leading-relaxed">
                    <!-- JSì—ì„œ ë¬¸êµ¬ ì‚½ì… -->
                </p>
            </div>
            <button onclick="finalKakaoRedirect()" class="w-full bg-[#FEE500] hover:bg-[#E5CF00] text-[#191919] font-bold py-3.5 rounded-xl transition-colors shadow-lg">
                ì¹´ì¹´ì˜¤í†¡ ë°”ë¡œ ì—´ê¸°
            </button>
            <button onclick="closeCustomAlert()" class="w-full mt-3 text-gray-500 hover:text-gray-300 text-sm font-bold py-2 transition-colors">
                ì·¨ì†Œ (ë‹«ê¸°)
            </button>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="mt-12 text-center pb-8">
        <p class="text-gray-600 text-sm">
            í•­ëª©ì„ í´ë¦­í•˜ì—¬ ì§ˆë¬¸í•  ë¬¸í•­ì„ ë©”ëª¨í•˜ê³  ì¹´í†¡ìœ¼ë¡œ ì¸ì¦í•˜ì„¸ìš”.<br>
            &copy; 2026 ìˆ˜í•™ê°•ì‚¬ í•œí˜¸ë¹ˆ.
        </p>
    </footer>

    <script>
        // ==========================================
        // âš ï¸ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì›¹ì•± URL ì„¸íŒ… ì™„ë£Œ
        // ==========================================
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyBO-fZw-58tAfn_TvfIhDzpku5cPs1gpSDwpRJaexycgVW1AsZEJVhg5bpN_yRhwv1/exec"; 

        // í•™ìƒë“¤ì˜ ì…ë ¥ ë°ì´í„°ë¥¼ ì €ì¥í•  ê°ì²´
        const taskStore = {};

        // í˜„ì¬ ì—´ë ¤ìˆëŠ” ëª¨ë‹¬ì˜ ì •ë³´
        let currentTask = { id: '', date: '', range: '', className: '', checkClass: '', weekNum: 0, dayNum: 0 };
        let currentSelectedQs = new Set(); // ì„ íƒëœ ì§ˆë¬¸ ë¬¸í•­ ë²ˆí˜¸ë¥¼ ë‹´ëŠ” Set ê°ì²´
        let selectedPhotos = []; // ë‹¤ì¤‘ ì‚¬ì§„ ì €ì¥ì„ ìœ„í•œ ë°°ì—´

        // --- ë°ì´í„° êµ¬ì¡° ì„¤ê³„ (ê³„ì‚°ëœ ë¬¸í•­ ë¶„ë°°) ---
        
        // ë‚ ì§œ ë°°ì—´ (3ì›” 3ì¼ ~ 4ì›” 5ì¼, ì£¼ 5ì¼)
        const dates = [
            "3/3(í™”)", "3/4(ìˆ˜)", "3/5(ëª©)", "3/6(ê¸ˆ)", "3/7(í† )",
            "3/10(í™”)", "3/11(ìˆ˜)", "3/12(ëª©)", "3/13(ê¸ˆ)", "3/14(í† )",
            "3/17(í™”)", "3/18(ìˆ˜)", "3/19(ëª©)", "3/20(ê¸ˆ)", "3/21(í† )",
            "3/24(í™”)", "3/25(ìˆ˜)", "3/26(ëª©)", "3/27(ê¸ˆ)", "3/28(í† )",
            "3/31(í™”)", "4/1(ìˆ˜)", "4/2(ëª©)", "4/3(ê¸ˆ)", "4/4(í† )"
        ];

        // ìˆ˜ì§ë°˜ ìŠ¤ì¼€ì¤„ (Cë‹¨ê³„ ë‚œì´ë„ ê³ ë ¤, Bë‹¨ê³„ ìœ„ì£¼ëŠ” 24~27ì œ, Cë‹¨ê³„ í¬í•¨ì€ 14~18ì œ)
        const verticalData = [
            // 1ì£¼ì°¨
            { range: "01.ì§€ìˆ˜ B 9~35", count: 27 },
            { range: "01.ì§€ìˆ˜ B 36~62", count: 27 },
            { range: "01.ì§€ìˆ˜ B 63~71, C 72~78", count: 16 },
            { range: "01.ì§€ìˆ˜ C 79~85, 02.ë¡œê·¸ B 94~100", count: 14 },
            { range: "02.ë¡œê·¸ B 101~126", count: 26 },
            // 2ì£¼ì°¨
            { range: "02.ë¡œê·¸ B 127~152", count: 26 },
            { range: "02.ë¡œê·¸ C 153~166", count: 14 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 182~207", count: 26 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 208~233", count: 26 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 234~259", count: 26 },
            // 3ì£¼ì°¨
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 260~270, C 271~275", count: 16 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ C 276~286, 04.ë¡œê·¸í•¨ìˆ˜ B 303~307", count: 16 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 308~331", count: 24 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 332~355", count: 24 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 356~379", count: 24 },
            // 4ì£¼ì°¨
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 380~401", count: 22 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ C 402~417", count: 16 },
            { range: "05.ì‚¼ê°í•¨ìˆ˜ B 434~459", count: 26 },
            { range: "05.ì‚¼ê°í•¨ìˆ˜ B 460~485", count: 26 },
            { range: "05.ì‚¼ê°í•¨ìˆ˜ B 486~500, C 501~503", count: 18 },
            // 5ì£¼ì°¨
            { range: "05.ì‚¼ê°í•¨ìˆ˜ C 504~513, 06.ì‚¼ê°ê·¸ë˜í”„ B 530~535", count: 16 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ B 536~561", count: 26 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ B 562~587", count: 26 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ B 588~609", count: 22 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ C 610~624", count: 15 }
        ];

        // ìƒìŠ¹ë°˜ ìŠ¤ì¼€ì¤„ (Bë‹¨ê³„, ì•½ 18ì œ)
        const risingData = [
            // 1ì£¼ì°¨
            { range: "01.ì§€ìˆ˜ B 9~26", count: 18 },
            { range: "01.ì§€ìˆ˜ B 27~44", count: 18 },
            { range: "01.ì§€ìˆ˜ B 45~62", count: 18 },
            { range: "01.ì§€ìˆ˜ B 63~71, 02.ë¡œê·¸ B 94~102", count: 18 },
            { range: "02.ë¡œê·¸ B 103~120", count: 18 },
            // 2ì£¼ì°¨
            { range: "02.ë¡œê·¸ B 121~138", count: 18 },
            { range: "02.ë¡œê·¸ B 139~152, 03.ì§€ìˆ˜í•¨ìˆ˜ B 182~185", count: 18 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 186~203", count: 18 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 204~221", count: 18 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 222~239", count: 18 },
            // 3ì£¼ì°¨
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 240~257", count: 18 },
            { range: "03.ì§€ìˆ˜í•¨ìˆ˜ B 258~270, 04.ë¡œê·¸í•¨ìˆ˜ B 303~307", count: 18 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 308~327", count: 20 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 328~347", count: 20 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 348~367", count: 20 },
            // 4ì£¼ì°¨
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 368~387", count: 20 },
            { range: "04.ë¡œê·¸í•¨ìˆ˜ B 388~401, 05.ì‚¼ê°í•¨ìˆ˜ B 434~437", count: 18 },
            { range: "05.ì‚¼ê°í•¨ìˆ˜ B 438~455", count: 18 },
            { range: "05.ì‚¼ê°í•¨ìˆ˜ B 456~473", count: 18 },
            { range: "05.ì‚¼ê°í•¨ìˆ˜ B 474~491", count: 18 },
            // 5ì£¼ì°¨
            { range: "05.ì‚¼ê°í•¨ìˆ˜ B 492~500, 06.ì‚¼ê°ê·¸ë˜í”„ B 530~538", count: 18 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ B 539~558", count: 20 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ B 559~578", count: 20 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ B 579~598", count: 20 },
            { range: "06.ì‚¼ê°ê·¸ë˜í”„ B 599~609", count: 11 }
        ];

        // HTML ë Œë”ë§ í•¨ìˆ˜
        function renderSchedule(data, containerId, themeClass, textThemeClass, checkClass) {
            const container = document.getElementById(containerId);
            let html = '';

            for (let week = 0; week < 5; week++) {
                html += `
                <div class="bg-[#1E1E1E] rounded-2xl border border-gray-800 p-5 shadow-lg">
                    <h3 class="text-xl font-bold mb-4 ${textThemeClass} border-b border-gray-800 pb-3">
                        ${week + 1}ì£¼ì°¨ í”Œë˜ë„ˆ
                    </h3>
                    <div class="space-y-1">
                `;

                for (let day = 0; day < 5; day++) {
                    const index = week * 5 + day;
                    const item = data[index];
                    const dateStr = dates[index];
                    const uniqueId = `${containerId}-w${week}-d${day}`;
                    const classNameStr = themeClass.includes('blue') ? 'ìˆ˜ì§ë°˜' : 'ìƒìŠ¹ë°˜';

                    // ë°ì´í„° ìŠ¤í† ì–´ ì´ˆê¸°í™” (qsë¥¼ ë°°ì—´ í˜•ì‹ìœ¼ë¡œ ë³€ê²½)
                    if (!taskStore[uniqueId]) {
                        taskStore[uniqueId] = { isDone: false, qs: [], memo: '' };
                    }

                    // label ëŒ€ì‹  div ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½, ì§ì ‘ ëª¨ë‹¬ ì˜¤í”ˆ
                    html += `
                        <div onclick="openTaskModal('${uniqueId}', '${dateStr}', '${item.range}', '${classNameStr}', '${checkClass}', ${week + 1}, ${day + 1})" 
                             class="flex justify-between items-center p-3 hover:bg-[#252525] rounded-xl cursor-pointer transition-all group active:scale-[0.98]">
                            <div class="flex items-center gap-3">
                                <span class="w-9 h-9 rounded-full ${themeClass} bg-opacity-10 flex items-center justify-center font-bold text-sm border border-transparent group-hover:border-current transition-colors">
                                    D${day + 1}
                                </span>
                                <div>
                                    <div class="text-xs text-gray-500 font-medium mb-0.5">${dateStr}</div>
                                    <div class="text-gray-200 font-medium text-sm md:text-base">${item.range}</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="text-xs font-bold text-gray-500 bg-[#121212] px-2 py-1 rounded hidden md:inline-block">${item.count}ì œ</span>
                                
                                <!-- ì²´í¬ë°•ìŠ¤ UI ë Œë”ë§ (ëª¨ë‹¬ì—ì„œ ì œì–´ë¨) -->
                                <div class="relative flex items-center justify-center">
                                    <div id="ui-box-${uniqueId}" class="w-6 h-6 border-2 border-gray-600 rounded check-btn flex items-center justify-center bg-transparent">
                                        <svg id="ui-svg-${uniqueId}" class="w-4 h-4 opacity-0 text-white transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                html += `</div></div>`;
            }
            container.innerHTML = html;
        }

        // ì´ˆê¸° ë Œë”ë§
        renderSchedule(verticalData, 'vertical-schedule-container', 'text-blue-400 bg-blue-500', 'text-white', 'checked-v');
        renderSchedule(risingData, 'rising-schedule-container', 'text-red-400 bg-red-500', 'text-white', 'checked-r');

        // íƒ­ ì „í™˜ ë¡œì§
        function switchTab(tab) {
            const btnV = document.getElementById('tab-vertical');
            const btnR = document.getElementById('tab-rising');
            const contV = document.getElementById('content-vertical');
            const contR = document.getElementById('content-rising');

            if (tab === 'vertical') {
                btnV.className = "px-8 py-3 rounded-xl font-bold text-lg transition-all text-white bg-blue-600/20 border border-blue-500/50 shadow-[0_0_15px_rgba(59,130,246,0.2)]";
                btnV.innerHTML = '<span class="gradient-vertical">ìˆ˜ì§ë°˜</span> (B+Cë‹¨ê³„)';
                
                btnR.className = "px-8 py-3 rounded-xl font-bold text-lg transition-all text-gray-500 hover:text-gray-300 border border-transparent";
                btnR.innerHTML = '<span class="text-gray-400">ìƒìŠ¹ë°˜</span> (Bë‹¨ê³„)';

                contV.classList.remove('hidden');
                contR.classList.add('hidden');
            } else {
                btnR.className = "px-8 py-3 rounded-xl font-bold text-lg transition-all text-white bg-red-600/20 border border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.2)]";
                btnR.innerHTML = '<span class="gradient-rising">ìƒìŠ¹ë°˜</span> (Bë‹¨ê³„)';
                
                btnV.className = "px-8 py-3 rounded-xl font-bold text-lg transition-all text-gray-500 hover:text-gray-300 border border-transparent";
                btnV.innerHTML = '<span class="text-gray-400">ìˆ˜ì§ë°˜</span> (B+Cë‹¨ê³„)';

                contR.classList.remove('hidden');
                contV.classList.add('hidden');
            }
        }

        // --- ëª¨ë‹¬ ë° ì¹´ì¹´ì˜¤í†¡ ì¸ì¦ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ ---
        
        const modalToggleCheck = document.getElementById('modalStatusCheck');
        const modalStatusText = document.getElementById('modalStatusText');

        // ëª¨ë‹¬ ë‚´ í† ê¸€ ìƒíƒœ í…ìŠ¤íŠ¸ ë³€ê²½ ì´ë²¤íŠ¸
        modalToggleCheck.addEventListener('change', function() {
            if (this.checked) {
                modalStatusText.textContent = 'ì™„ë£Œ (ì¸ì¦ëŒ€ê¸°)';
                modalStatusText.classList.replace('text-gray-400', currentTask.className === 'ìˆ˜ì§ë°˜' ? 'text-blue-400' : 'text-red-400');
            } else {
                modalStatusText.textContent = 'ë¯¸ì™„ë£Œ';
                modalStatusText.className = 'ml-3 text-sm font-bold text-gray-400';
            }
        });

        function openTaskModal(id, date, range, className, checkClass, weekNum, dayNum) {
            currentTask = { id, date, range, className, checkClass, weekNum, dayNum };
            const data = taskStore[id];

            // UI ì±„ìš°ê¸°
            document.getElementById('modalDateTitle').textContent = `${date} ìˆ™ì œ`;
            document.getElementById('modalRangeDesc').textContent = range;
            
            const badge = document.getElementById('modalClassBadge');
            badge.textContent = className;
            if(className === 'ìˆ˜ì§ë°˜') {
                badge.className = "text-xs font-bold px-2 py-1 rounded inline-block mb-2 bg-blue-500/20 text-blue-400";
                document.getElementById('modalToggleBg').classList.replace('peer-checked:bg-red-500', 'peer-checked:bg-blue-500');
            } else {
                badge.className = "text-xs font-bold px-2 py-1 rounded inline-block mb-2 bg-red-500/20 text-red-400";
                document.getElementById('modalToggleBg').classList.replace('peer-checked:bg-blue-500', 'peer-checked:bg-red-500');
            }

            // ê¸°ì¡´ ì…ë ¥ ë°ì´í„° ì„¸íŒ…
            modalToggleCheck.checked = data.isDone;
            modalToggleCheck.dispatchEvent(new Event('change')); // í…ìŠ¤íŠ¸ ê°•ì œ ì—…ë°ì´íŠ¸
            
            // ì‚¬ì§„ UI ì´ˆê¸°í™”
            removePhoto();

            // ì €ì¥ëœ ë°°ì—´ì„ Setìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë²„íŠ¼ ë Œë”ë§ ì¤€ë¹„
            currentSelectedQs = new Set(data.qs);
            generateQuestionButtons(range); // í˜„ì¬ ìˆ™ì œ ë²”ìœ„ì— ë§ì¶° ë¬¸í•­ ë²„íŠ¼ ë Œë”ë§
            
            document.getElementById('modalMemoInput').value = data.memo;
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ ì´ë¦„ì´ ìˆë‹¤ë©´ ë¶ˆëŸ¬ì˜¤ê¸° (í•™ìƒ í¸ì˜ì„±)
            const savedName = localStorage.getItem('signatureStudentName');
            if (savedName) document.getElementById('modalStudentName').value = savedName;

            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('taskModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // ë²”ìœ„ í…ìŠ¤íŠ¸(ì˜ˆ: "01.ì§€ìˆ˜ B 9~35")ë¥¼ ë¶„ì„í•˜ì—¬ ë™ì ìœ¼ë¡œ ë²ˆí˜¸ ë²„íŠ¼ ìƒì„±
        function generateQuestionButtons(rangeStr) {
            const container = document.getElementById('modalQsContainer');
            container.innerHTML = '';
            
            // B ë˜ëŠ” Cì™€ ê·¸ ë’¤ì˜ ìˆ«ì ë²”ìœ„ë¥¼ ì¶”ì¶œí•˜ëŠ” ì •ê·œì‹
            const regex = /(B|C)\s*(\d+)~(\d+)/g;
            let match;
            
            while ((match = regex.exec(rangeStr)) !== null) {
                const level = match[1]; // 'B' ë˜ëŠ” 'C'
                const start = parseInt(match[2], 10);
                const end = parseInt(match[3], 10);

                for (let i = start; i <= end; i++) {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.textContent = i;
                    btn.dataset.level = level;
                    
                    // í˜„ì¬ ë¬¸í•­ì´ ì´ì „ì— ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
                    const isSelected = currentSelectedQs.has(i.toString());
                    toggleBtnStyle(btn, isSelected);

                    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ì„ íƒ/í•´ì œ)
                    btn.onclick = () => {
                        const currentlySelected = currentSelectedQs.has(i.toString());
                        if (currentlySelected) {
                            currentSelectedQs.delete(i.toString());
                            toggleBtnStyle(btn, false);
                        } else {
                            currentSelectedQs.add(i.toString());
                            toggleBtnStyle(btn, true);
                        }
                    };
                    
                    container.appendChild(btn);
                }
            }
            
            // ë§Œì•½ ì¶”ì¶œì— ì‹¤íŒ¨í•˜ì—¬ ë²„íŠ¼ì´ ì—†ì„ ê²½ìš° ì˜ˆì™¸ì²˜ë¦¬
            if (container.children.length === 0) {
                container.innerHTML = '<span class="text-gray-500 text-sm">ë¬¸í•­ ë²ˆí˜¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>';
            }
        }

        // --- ì‚¬ì§„ ì²˜ë¦¬ ë¡œì§ ---
        function handlePhotoSelection(event) {
            const files = Array.from(event.target.files);
            if (files.length > 0) {
                selectedPhotos = files; // ìƒˆ íŒŒì¼ë“¤ë¡œ ë®ì–´ì“°ê¸°
                
                const grid = document.getElementById('photoGrid');
                grid.innerHTML = ''; // ì´ˆê¸°í™”
                
                selectedPhotos.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-20 h-20 object-cover rounded-lg border border-gray-600 flex-shrink-0';
                        grid.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });

                document.getElementById('photoCountText').innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> ${selectedPhotos.length}ì¥ì˜ ì‚¬ì§„ ì¤€ë¹„ ì™„ë£Œ!`;
                
                document.getElementById('photoUploadBtn').classList.add('hidden');
                document.getElementById('photoPreviewContainer').classList.remove('hidden');
            }
        }

        function removePhoto() {
            document.getElementById('modalPhotoInput').value = '';
            selectedPhotos = [];
            document.getElementById('photoGrid').innerHTML = '';
            document.getElementById('photoPreviewContainer').classList.add('hidden');
            document.getElementById('photoUploadBtn').classList.remove('hidden');
        }

        // ì´ë¯¸ì§€ ì••ì¶• ë° Base64 ë³€í™˜ í•¨ìˆ˜ (ëª¨ë°”ì¼ ì—…ë¡œë“œ ì†ë„ ìµœì í™”)
        function resizeAndEncodeImage(file, maxWidth = 1024) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        if (width > maxWidth) {
                            height = Math.round((height * maxWidth) / width);
                            width = maxWidth;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // JPEG í¬ë§·ìœ¼ë¡œ í’ˆì§ˆ 70% ì••ì¶•
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                        resolve({
                            data: dataUrl,
                            mimeType: 'image/jpeg'
                        });
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        // ë¬¸í•­ ë²„íŠ¼ì˜ ìƒíƒœ(B/Cë‹¨ê³„ ë° ì„ íƒì—¬ë¶€)ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ë³€ê²½
        function toggleBtnStyle(btn, isSelected) {
            const level = btn.dataset.level;
            if (isSelected) {
                // ì„ íƒë˜ì—ˆì„ ë•Œ (ìƒ‰ìƒì´ ì±„ì›Œì§ + ì•½ê°„ ì»¤ì§)
                if (level === 'B') {
                    btn.className = 'w-[42px] h-[42px] rounded-lg text-sm font-bold flex items-center justify-center transition-all border-2 border-blue-500 bg-blue-500 text-white shadow-[0_0_10px_rgba(59,130,246,0.5)] scale-105';
                } else {
                    btn.className = 'w-[42px] h-[42px] rounded-lg text-sm font-bold flex items-center justify-center transition-all border-2 border-red-500 bg-red-500 text-white shadow-[0_0_10px_rgba(239,68,68,0.5)] scale-105';
                }
            } else {
                // ê¸°ë³¸ ìƒíƒœ
                if (level === 'B') {
                    btn.className = 'w-[42px] h-[42px] rounded-lg text-sm font-bold flex items-center justify-center transition-all border border-blue-900/50 text-blue-400 bg-blue-900/10 hover:bg-blue-800/30';
                } else {
                    btn.className = 'w-[42px] h-[42px] rounded-lg text-sm font-bold flex items-center justify-center transition-all border border-red-900/50 text-red-400 bg-red-900/10 hover:bg-red-800/30';
                }
            }
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // ì €ì¥ ë¡œì§ (ëª¨ë‹¬ ì…ë ¥ ë°ì´í„°ë¥¼ ê°ì²´ì— ì €ì¥í•˜ê³  ë¦¬ìŠ¤íŠ¸ UIì˜ ì²´í¬ë°•ìŠ¤ë¥¼ ë™ê¸°í™”)
        function saveAndCloseTaskModal() {
            const isDone = modalToggleCheck.checked;
            
            // ë°ì´í„° ì—…ë°ì´íŠ¸ (Setì„ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ìˆ«ì ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬)
            taskStore[currentTask.id] = {
                isDone: isDone,
                qs: Array.from(currentSelectedQs).sort((a, b) => parseInt(a) - parseInt(b)),
                memo: document.getElementById('modalMemoInput').value.trim()
            };

            // ë¦¬ìŠ¤íŠ¸ UI ì—…ë°ì´íŠ¸
            const box = document.getElementById(`ui-box-${currentTask.id}`);
            const svg = document.getElementById(`ui-svg-${currentTask.id}`);
            
            if (isDone) {
                box.classList.add(currentTask.checkClass);
                box.classList.add('border-transparent');
                svg.classList.replace('opacity-0', 'opacity-100');
            } else {
                box.classList.remove(currentTask.checkClass);
                box.classList.remove('border-transparent');
                svg.classList.replace('opacity-100', 'opacity-0');
            }

            closeTaskModal();
        }

        // êµ¬ê¸€ ì‹œíŠ¸ ì „ì†¡ ë° ì¹´ì¹´ì˜¤í†¡ ë³µì‚¬ í†µí•© ë¡œì§
        async function submitDataAndCopy() {
            const studentName = document.getElementById('modalStudentName').value.trim();
            if (!studentName) {
                alert("í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                document.getElementById('modalStudentName').focus();
                return;
            }
            
            // ì´ë¦„ ê¸°ì–µí•˜ê¸°
            localStorage.setItem('signatureStudentName', studentName);

            const isDone = modalToggleCheck.checked;
            const qsArr = Array.from(currentSelectedQs).sort((a, b) => parseInt(a) - parseInt(b));
            const qsText = qsArr.length > 0 ? qsArr.join(', ') : 'ì—†ìŒ';
            const memo = document.getElementById('modalMemoInput').value.trim();
            const stateText = isDone ? "ì™„ë£Œ" : "ë¯¸ì™„ë£Œ";
            const stateIcon = isDone ? "â­• ì™„ë£Œ" : "âŒ ë¯¸ì™„ë£Œ";

            // 1. ì¹´ì¹´ì˜¤í†¡ìš© í…ìŠ¤íŠ¸ ì¡°ë¦½
            let copyText = `[Signature ${currentTask.className} ìˆ™ì œ ì¸ì¦]\n` +
                           `ğŸ§‘â€ğŸ“ ì´ë¦„: ${studentName}\n` +
                           `ğŸ“… ì¼ì: ${currentTask.weekNum}ì£¼ì°¨ D${currentTask.dayNum} (${currentTask.date})\n` +
                           `ğŸ“š ë²”ìœ„: ${currentTask.range}\n` +
                           `âœ… ìƒíƒœ: ${stateIcon}\n` +
                           `â“ ì§ˆë¬¸ë¬¸í•­: ${qsText}\n`;
            if (memo) copyText += `ğŸ“ ì½”ë©˜íŠ¸: ${memo}\n`;

            // â˜… í•´ê²° í•µì‹¬: ì‹œê°„ ì§€ì—°(await)ì´ ë°œìƒí•˜ê¸° ì „ì—, ë²„íŠ¼ì„ ëˆ„ë¥´ìë§ˆì ì¦‰ì‹œ í´ë¦½ë³´ë“œì— ë³µì‚¬í•©ë‹ˆë‹¤. (ê¶Œí•œ ì—ëŸ¬ ë°©ì§€)
            try {
                const textArea = document.createElement("textarea");
                textArea.value = copyText;
                textArea.style.position = "fixed";
                textArea.style.left = "-999999px"; // í™”ë©´ ë°–ìœ¼ë¡œ ìˆ¨ê¹€
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                document.execCommand('copy'); // êµ¬í˜• APIì§€ë§Œ iFrame ë“± ì œí•œëœ í™˜ê²½ì—ì„œ ê°€ì¥ í™•ì‹¤íˆ ë™ì‘í•¨
                textArea.remove();
            } catch (err) {
                console.error("í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:", err);
            }

            // 2. ë¡œë”© UI í‘œì‹œ (í´ë¦½ë³´ë“œ ë³µì‚¬ ì™„ë£Œ í›„ í™”ë©´ ì „í™˜)
            document.getElementById('loadingOverlay').classList.remove('hidden');

            // 3. êµ¬ê¸€ ì‹œíŠ¸ ë° ë“œë¼ì´ë¸Œë¡œ ë°ì´í„°/ì‚¬ì§„ ì „ì†¡
            try {
                // ì´ë¯¸ì§€ ì••ì¶• ì²˜ë¦¬ (ë¹„ë™ê¸°)
                const base64Images = [];
                if (selectedPhotos.length > 0) {
                    for (let file of selectedPhotos) {
                        const encoded = await resizeAndEncodeImage(file);
                        base64Images.push(encoded);
                    }
                }

                // êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¡œ ì „ì†¡í•  ë°ì´í„° í˜ì´ë¡œë“œ
                const payload = {
                    name: studentName,
                    className: currentTask.className,
                    date: `${currentTask.weekNum}ì£¼ì°¨ D${currentTask.dayNum} (${currentTask.date})`,
                    range: currentTask.range,
                    status: stateText,
                    questions: qsText,
                    memo: memo,
                    images: base64Images
                };

                // êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ë¡œ POST ìš”ì²­ (no-cors ì ìš©)
                if (GOOGLE_SCRIPT_URL.startsWith("https://script.google.com/")) {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                        body: JSON.stringify(payload)
                    });
                }
            } catch (error) {
                // êµ¬ê¸€ ì„œë²„ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë‚˜ë”ë¼ë„ ì¹´í†¡ ì œì¶œì€ ë§‰íˆì§€ ì•Šë„ë¡ ì¡°ì¹˜
                console.error("ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì „ì†¡ ì˜¤ë¥˜:", error);
            } finally {
                // 4. ë¡œë”© UI ìˆ¨ê¹€ ë° ì•ˆë‚´ íŒì—… ì˜¤í”ˆ
                document.getElementById('loadingOverlay').classList.add('hidden');
                executeKakaoRedirect();
            }
        }

        function executeKakaoRedirect() {
            const hasPhoto = selectedPhotos.length > 0;
            const warningText = document.getElementById('customAlertWarning');
            
            if (hasPhoto) {
                warningText.innerHTML = `ğŸ“¸ ìŠì§€ ë§ˆì„¸ìš”!<br>ì±„íŒ…ë°©ì—ì„œ ë°©ê¸ˆ ì¤€ë¹„í•œ <strong>[${selectedPhotos.length}ì¥ì˜ ìˆ™ì œ ì‚¬ì§„]</strong>ì„ ì§ì ‘ ì²¨ë¶€í•˜ì—¬ í•¨ê»˜ ì „ì†¡í•´ì•¼ í•©ë‹ˆë‹¤.`;
            } else {
                warningText.innerHTML = `âš ï¸ ì£¼ì˜!<br>ìˆ™ì œ ì‚¬ì§„ë„ í•¨ê»˜ ì²¨ë¶€í•˜ì—¬ ì „ì†¡í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”.`;
            }

            // ë¸Œë¼ìš°ì € alert() ëŒ€ì‹  ì»¤ìŠ¤í…€ ëª¨ë‹¬ ë„ìš°ê¸° (íŒì—… ì°¨ë‹¨ ë°©ì§€)
            document.getElementById('customAlertModal').classList.remove('hidden');
        }

        function finalKakaoRedirect() {
            document.getElementById('customAlertModal').classList.add('hidden');
            saveAndCloseTaskModal();
            // í•œí˜¸ë¹ˆ ê°•ì‚¬ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°© ë§í¬
            window.open("https://open.kakao.com/o/s9qHTzTh", "_blank");
        }
        
        function closeCustomAlert() {
            document.getElementById('customAlertModal').classList.add('hidden');
        }
    </script>
<script>
  // 1. ë§ˆìš°ìŠ¤ ìš°í´ë¦­ ë°©ì§€
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault(); // ìš°í´ë¦­ ë©”ë‰´ê°€ ëœ¨ì§€ ì•Šê²Œ í•©ë‹ˆë‹¤.
    // alert('ë³´ì•ˆì„ ìœ„í•´ ìš°í´ë¦­ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); // ê²½ê³ ì°½ì´ í•„ìš”í•˜ë©´ ì£¼ì„(//)ì„ ì§€ìš°ì„¸ìš”.
  });

  // 2. ê°œë°œì ë„êµ¬ ë° ì†ŒìŠ¤ ë³´ê¸° ë‹¨ì¶•í‚¤ ë°©ì§€
  document.addEventListener('keydown', function(e) {
    // F12 í‚¤ ë°©ì§€ (ê°€ì¥ ë§ì´ ì“°ëŠ” ê°œë°œì ë„êµ¬ í‚¤)
    if (e.keyCode === 123) {
      e.preventDefault();
      e.returnValue = false;
    }

    // Ctrl+Shift+I (ê°œë°œì ë„êµ¬) / Ctrl+Shift+J (ì½˜ì†”) / Ctrl+Shift+C (ìš”ì†Œ ê²€ì‚¬)
    if (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) {
      e.preventDefault();
      e.returnValue = false;
    }

    // Ctrl+U (ì†ŒìŠ¤ ë³´ê¸°)
    if (e.ctrlKey && e.keyCode === 85) {
      e.preventDefault();
      e.returnValue = false;
    }
  });
</script>
</body>
</html>
